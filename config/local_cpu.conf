# Documentation
# https://cromwell.readthedocs.io/

include required(classpath("application"))

webservice {
  port = 9000
  interface = 0.0.0.0
  instance.name = "reference"
}

system {
  abort-jobs-on-terminate = false
  max-retries = 3
  workflow-restart = true
  file-hash-cache = true
  max-concurrent-workflows = 24
  max-workflow-launch-count = 50
  new-workflow-poll-rate = 20
  number-of-workflow-log-copy-workers = 10
}

call-caching {
  enabled = true
  invalidate-bad-cache-results = false
  blacklist-cache {
    enabled: true
    concurrency: 10000
    ttl: 200 minutes
    size: 1000
  }
}

docker {
  hash-lookup {
    cache-size = 200
    method = "remote"
  }
}

backend {
  default = "Local"
  providers {
    Local {
      actor-factory = "cromwell.backend.impl.sfs.config.ConfigBackendLifecycleActorFactory"
      config {
        concurrent-job-limit = 24
        run-in-background = true
        runtime-attributes = "String? docker Int? max_runtime = 2"
        submit = "/bin/bash ${script}"
        submit-docker = "docker run --rm -v ${cwd}:${docker_cwd} -i ${docker} /bin/bash < ${script}"

        root: "../cromwell-executions"

        filesystems {
          local {
            localization: [
              "hard-link", "soft-link", "copy"
            ]
            # Call caching strategies
            caching {
              duplication-strategy: [
                "hard-link", "soft-link", "copy"
              ]
              hashing-strategy: "md5"
              check-sibling-md5: false
            }
          }
        }
      }
    }
  }
}

workflow-options {
    workflow_failure_mode = "ContinueWhilePossible"
    workflow-log-dir = "../cromwell-workflow-logs"
    workflow-log-temporary = false
}

database {
  profile = "slick.jdbc.MySQLProfile$"
  db {
    driver = "com.mysql.cj.jdbc.Driver"
    url = "jdbc:mysql://localhost/cromwell_db?rewriteBatchedStatements=true&useSSL=false"
    user = "cromwell"
    password = "cromwell"
    connectionTimeout = 5000
  }
}